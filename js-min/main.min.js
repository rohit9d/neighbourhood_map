function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:2}),largeInfoWindow=new google.maps.InfoWindow,highlightedIcon=makeMarkerIcon("ed4b74"),clickedIcon=makeMarkerIcon("f79336"),google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)})}function makeMarkerIcon(a){var b=new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+a+"|40|_|%E2%80%A2",new google.maps.Size(23,36),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(23,36));return b}var map,bounds,vm,largeInfoWindow,highIcon,clickIcon,marker,finish,yelp_request,loc1={lat:"",lng:""},empty=!1,hover=!1,click=!1,loca,markers=[],model1=[],ViewModel=function(){var a=$("#menu"),b=$(".sidebar");a.click(function(){b.toggleClass("open")});var c=this;this.query=ko.observable(""),this.mylocation=ko.observable("Enter a location"),this.restaurants=ko.observableArray([]),this.currentrestaurant=ko.observable(),this.changelocation=function(a){c.restaurants.removeAll();for(var b=0;b<markers.length&&0==empty;)console.log("emptying"),markers[b].setMap(null),markers[b]={},model1[b]={},b++;empty=!0,""!=a?(yelp(a),yelp_request=setTimeout(function(){for(var a=0;a<model1.length;a++)c.restaurants.push(model1[a]);bounds=new google.maps.LatLngBounds,add_markers_to_map(model1)},3e3)):console.log("enter a valid location")},this.showinfo=function(a){c.currentrestaurant=a,populateInfoWindow(markers[c.currentrestaurant.id],largeInfoWindow)},this.search=function(a){c.restaurants.removeAll();for(var b in model1)markers[b].setMap(null),model1[b].name.toLowerCase().indexOf(a.toLowerCase())>=0&&(c.restaurants.push(model1[b]),markers[b].setMap(map))}},vm=new ViewModel;vm.query.subscribe(vm.search),vm.mylocation.subscribe(vm.changelocation),ko.applyBindings(vm),mapdiv=$("#map"),populateInfoWindow=function(a,b){b.marker!=a&&(b.marker=a,b.setContent('<div class="InfoWindow"><h2 class="name">'+a.title+'</h2><span class ="info" >'+a.info+'</span><img src="'+a.img+'"</div>'),b.open(map,a)),b.addListener("closeclick",function(){a.setIcon(),b.close(),click=!1})},add_markers_to_map=function(a){empty=!1;for(var b=0;b<a.length;b++)marker=new google.maps.Marker({position:a[b].location,map:map,title:a[b].name,animation:google.maps.Animation.DROP,id:a[b].id,info:a[b].info,img:a[b].img}),markers[b]=marker,bounds.extend(marker.position),markers[b].setMap(map),bounds.extend(markers[b].position),marker.addListener("click",function(){this.setIcon(clickedIcon),click=!0,populateInfoWindow(this,largeInfoWindow)}),marker.addListener("mouseover",function(){0==click&&(this.setIcon(highlightedIcon),hover=!0)}),marker.addListener("mouseout",function(){1!=click&&(this.setIcon(),hover=!1)}),map.fitBounds(bounds)};